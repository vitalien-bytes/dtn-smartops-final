<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ board.title }}</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<header class="topbar">
    <div class="logo-title">
        <img src="/static/logo.png" alt="Logo DTN" class="logo">
        <h1><span class="black">DTN</span> <span class="orange">SmartOps</span></h1>
    </div>

    <div class="header-actions">
        <button id="darkToggle" class="mode-toggle">üåô</button>
        <a href="/logout"><button class="logout-btn">D√©connexion</button></a>
    </div>
</header>

<main class="board-container">
    <aside class="sidebar">
        <h3>Gestion</h3>
        <ul>
            <li><a href="/board">Tableaux</a></li>
            <li><a href="#">T√¢ches archiv√©es</a></li>
            <li><a href="#">Utilisateurs</a></li>
            <li><a href="#">Statistiques</a></li>
        </ul>
    </aside>

    <section class="board">
        <!-- Formulaire pour ajouter une colonne -->
        <form method="post" action="/add_column" class="add-col-form">
            <input name="title" placeholder="Nouvelle section..." required>
            <button type="submit">Ajouter</button>
        </form>

        <!-- Colonnes -->
        {% for col in columns %}
        <div class="column" data-column-id="{{ col.id }}">
            <div class="column-header">
                <h2>{{ col.title }}</h2>
                <div class="dropdown">
                    <button class="menu-btn">‚ãÆ</button>
                    <div class="dropdown-content">
                        <form method="post" action="/rename_column/{{ col.id }}">
                            <input name="new_title" placeholder="Renommer...">
                            <button type="submit">OK</button>
                        </form>
                        <form method="post" action="/archive_column/{{ col.id }}">
                            <button type="submit">Archiver</button>
                        </form>
                        <form method="post" action="/delete_column/{{ col.id }}">
                            <button type="submit" class="danger">Supprimer</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="cards" data-column-id="{{ col.id }}">
                {% for card in col.cards %}
                <article class="card" draggable="true" data-card-id="{{ card.id }}">
                    <p>{{ card.description }}</p>
                    <form method="post" action="/delete_card/{{ card.id }}">
                        <button class="delete-btn" title="Supprimer la t√¢che">‚úï</button>
                    </form>
                </article>
                {% endfor %}
            </div>

            <form method="post" action="/add_card/{{ col.id }}" class="add-card-form">
                <input name="description" placeholder="Nouvelle t√¢che..." required>
                <button type="submit">+</button>
            </form>
        </div>
        {% endfor %}
    </section>
</main>

<!-- =====================
     SCRIPTS
====================== -->
<script>
    // ---- DRAG & DROP ----
    const cards = document.querySelectorAll('.card');
    const columns = document.querySelectorAll('.cards');

    cards.forEach(card => {
        card.addEventListener('dragstart', e => e.dataTransfer.setData('cardId', card.dataset.cardId));
    });

    columns.forEach(col => {
        col.addEventListener('dragover', e => e.preventDefault());
        col.addEventListener('drop', async e => {
            e.preventDefault();
            const cardId = e.dataTransfer.getData('cardId');
            const newColId = col.dataset.columnId;
            const response = await fetch(`/move_card/${cardId}/${newColId}`, { method: 'POST' });
            if (response.ok) location.reload();
        });
    });

    // ---- MODE SOMBRE / CLAIR ----
    const toggle = document.getElementById('darkToggle');
    if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark');

    toggle.onclick = () => {
        document.body.classList.toggle('dark');
        const theme = document.body.classList.contains('dark') ? 'dark' : 'light';
        localStorage.setItem('theme', theme);
        toggle.innerHTML = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    };
</script>

</body>
</html>
