<!doctype html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DTN SmartOps Board</title>
  <link rel="stylesheet" href="style.css"/>
</head>

<body class="light">

<!-- üîê PROTECTION MOT DE PASSE -->
<script>
  const BOARD_PASS = "FASTKEY"; // ‚Üê ton mot de passe global
  const p = prompt("üîê Mot de passe requis :");
  if(p !== BOARD_PASS) {
    alert("‚ùå Acc√®s refus√©");
    location.href = "index.html";
  } else {
    sessionStorage.setItem("auth","1");
  }
</script>

<header class="topbar">
  <div class="brand">
    <img src="/static/logo.png" alt="DTN SmartOps" class="logo"/>
    <span class="brand-text"><b>DTN</b><span class="accent">SmartOps</span></span>
  </div>
</header>

<main id="board" class="board"></main>

<!-- ‚öôÔ∏è Logique Kanban + Sauvegarde JSON Drive -->
<script>
const FILE_URL = "board-data.json";
let boardData = { columns: [] };

async function loadBoard(){
  try{
    const r = await fetch(FILE_URL);
    boardData = await r.json();
  }catch{
    console.warn("‚ö†Ô∏è board-data.json introuvable, init empty");
    boardData = {"columns":[]};
  }
  renderBoard();
}

function renderBoard(){
  const b = document.getElementById("board");
  b.innerHTML="";
  boardData.columns.forEach(col=>{
    const c = document.createElement("div");
    c.className="column";
    c.innerHTML=`<div class="column-head"><h3>${col.name}</h3></div><div class="cards"></div>`;
    const cw = c.querySelector(".cards");
    col.cards.forEach(card=>{
      const cd = document.createElement("div");
      cd.className="card";
      cd.draggable=true;
      cd.innerHTML=`<div class="card-name">${card.title}</div><span class="chip">${card.city}</span><p>${card.notes||""}</p>`;
      cw.appendChild(cd);
    });
    b.appendChild(c);
  });
}

async function saveBoard(){
  // Sauvegarde partag√©e dans Drive
  await fetch(FILE_URL, {
    method:"PUT",
    headers:{'content-type':'application/json'},
    body:JSON.stringify(boardData)
  });
}

loadBoard();
</script>

<button onclick="logout()" style="position:fixed;bottom:15px;right:15px;padding:10px;border-radius:8px;border:none;cursor:pointer">D√©connexion</button>
<script>
function logout(){
  sessionStorage.removeItem("auth");
  localStorage.removeItem("auth");
  location.href="index.html";
}
</script>

</body>
</html>
